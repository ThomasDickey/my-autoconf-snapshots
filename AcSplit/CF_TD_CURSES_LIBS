dnl Test for the varieties of curses libraries.
dnl
dnl	There are two main varieties of curses: BSD and SYSV.  The latter has
dnl	more features (e.g., keypad and function key support, auxiliary
dnl	character set).  The easiest thing to test for is the presence of
dnl	'keypad()' in the curses library.  BSD curses hasn't got it.
dnl
dnl	There's a free version of SYSV curses called 'ncurses'.  If we've got
dnl	that, configure for it instead of the BSD curses.
dnl
dnl	On SunOS, we may have both BSD and SYS5 curses (the latter under /5lib
dnl	and /5include).
dnl
AC_DEFUN([CF_TD_CURSES_LIBS],
[
AC_PROVIDE([$0])
# Check for gpm (general purpose mouse) since we may need this for ncurses.
AC_CHECK_LIB(gpm,Gpm_Open)
if test $WithNcurses = yes; then
	CF_MSG_LOG(ncurses library, by option)
	AC_CHECK_LIB(ncurses,initscr)
else
	# Check if we've already got curses functions in our library list
	# (e.g., if the user is overriding this test by setting $LIBS).
	CF_MSG_LOG(curses library, by default)
	AC_TRY_LINK([#include <curses.h>],
		[initscr()],
		[case "$LIBS" in
		 *libncurses.*|*-lncurses*)
		 	ac_cv_lib_ncurses_initscr=predefined
		 	ac_cv_lib_curses_initscr=no
		 	;;
		 *)
		 	ac_cv_lib_ncurses_initscr=no
		 	ac_cv_lib_curses_initscr=yes
		 	;;
		 esac],
		[ac_cv_lib_ncurses_initscr=unknown])
fi
CF_MSG_LOG(ncurses state $ac_cv_lib_ncurses_initscr)
if test $ac_cv_lib_ncurses_initscr = yes; then
	# Linux installs NCURSES's include files in a separate directory to avoid
	# confusion with the native curses.  NCURSES has its own termcap support.
	CF_INCLUDE_PATH(/usr/include/ncurses /usr/local/include/ncurses)
	ac_cv_lib_curses_initscr=yes
elif test $ac_cv_lib_ncurses_initscr = unknown; then
	# The curses library often depends on the termcap library, so we've checked
	# for it first.  We could make a more complicated test to ensure that we
	# don't add the termcap library, but some functions use it anyway if it's
	# there.
	AC_CHECK_LIB(termcap, tgetent)
	AC_CHECK_LIB(curses, initscr)
fi
# The main distinction between bsd- and sysv-curses is that the latter has a
# keypad function.
AC_MSG_CHECKING(BSD vs SYSV curses)
CF_MSG_LOG(curses-type BSD/SYSV)
AC_CACHE_VAL(cf_cv_curses_type,[
	cf_cv_curses_type=unknown
	if test .$ac_cv_lib_curses_initscr = .yes; then
		AC_TRY_LINK([#include <curses.h>],
			[keypad(curscr,1)],
			[cf_cv_curses_type=sysv],
			[cf_cv_curses_type=bsd])
	fi
])
AC_MSG_RESULT($cf_cv_curses_type)
])dnl
